import{c as E,d as U,r as i,b as H,s as u,j as e,L as q,R as T,H as L,w as D,X as F}from"./index-CuLUR7ue.js";import{N as R}from"./Navbar-DUxwz1eI.js";import{P as V,C as X,T as $}from"./confirmation-dialog-BDzsuAYg.js";import{C as y}from"./user-CLQm5Qt5.js";import"./hoist-non-react-statics.cjs-BgISz65J.js";/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const B=E("Save",[["path",{d:"M15.2 3a2 2 0 0 1 1.4.6l3.8 3.8a2 2 0 0 1 .6 1.4V19a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2z",key:"1c8476"}],["path",{d:"M17 21v-7a1 1 0 0 0-1-1H8a1 1 0 0 0-1 1v7",key:"1ydtos"}],["path",{d:"M7 3v4a1 1 0 0 0 1 1h7",key:"t51u73"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const G=E("SquarePen",[["path",{d:"M12 3H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7",key:"1m0v6g"}],["path",{d:"M18.375 2.625a1 1 0 0 1 3 3l-9.013 9.014a2 2 0 0 1-.853.505l-2.873.84a.5.5 0 0 1-.62-.62l.84-2.873a2 2 0 0 1 .506-.852z",key:"ohrbg2"}]]),J={name_ar:"",description_ar:"",price:0,image_url:"",rating:5,googleFormUrl:"",available:!0},ae=()=>{const{user:a,loading:g}=U(),[c,m]=i.useState([]),[d,r]=i.useState(null),[N,h]=i.useState(!1),[w,f]=i.useState(!0),[n,p]=i.useState(null),[v,j]=i.useState(null),[k,C]=i.useState(!1),{toast:o}=H();i.useEffect(()=>{(async()=>{if(!a){p(!1),f(!1);return}f(!0);try{const t=await D(a.id);p(t)}catch(t){console.error("خطأ في التحقق من صلاحية الأدمن:",t),p(!1)}finally{f(!1)}})()},[a]);const _=i.useCallback(async()=>{if(n)try{const{data:s,error:t}=await u.from("products").select("*").order("created_at",{ascending:!1});if(t)throw t;m(s||[])}catch(s){console.error(s),o({title:"خطأ",description:"فشل في تحميل المنتجات",variant:"destructive"})}},[n,o]);i.useEffect(()=>{n&&_()},[n,_]);const S=i.useCallback(async s=>{if(!a||!n){o({title:"خطأ",description:"ليست لديك الصلاحية",variant:"destructive"});return}C(!0);try{const t={name_ar:s.name_ar.trim(),description_ar:s.description_ar.trim(),price:s.price,image_url:s.image_url.trim(),rating:s.rating,googleFormUrl:s.googleFormUrl.trim(),available:s.available};if(!t.name_ar||!t.description_ar||!t.image_url)throw new Error("جميع الحقول المطلوبة يجب ملؤها");if(s.id){const{error:l}=await u.from("products").update(t).eq("id",s.id);if(l)throw l;m(x=>x.map(b=>b.id===s.id?{...s,...t}:b))}else{const{data:l,error:x}=await u.from("products").insert(t).select();if(x)throw x;if(!l||l.length===0)throw new Error("لم يتم إنشاء المنتج");m(b=>[l[0],...b])}o({title:"تم الحفظ",description:"تم حفظ المنتج بنجاح"}),r(null),h(!1)}catch(t){const l=t instanceof Error?t.message:"فشل في حفظ المنتج";console.error(t),o({title:"خطأ",description:l,variant:"destructive"})}finally{C(!1)}},[a,n,o]),I=i.useCallback(async s=>{if(!a||!n){o({title:"خطأ",description:"ليست لديك الصلاحية",variant:"destructive"});return}try{const{error:t}=await u.from("products").delete().eq("id",s);if(t)throw t;m(l=>l.filter(x=>x.id!==s)),o({title:"تم الحذف",description:"تم حذف المنتج بنجاح"})}catch{o({title:"خطأ",description:"فشل في حذف المنتج",variant:"destructive"})}finally{j(null)}},[a,n,o]),z=i.useCallback(async s=>{if(!a||!n){o({title:"خطأ",description:"ليست لديك الصلاحية",variant:"destructive"});return}try{const t={...s,available:!s.available},{error:l}=await u.from("products").update({available:t.available}).eq("id",s.id);if(l)throw l;m(x=>x.map(b=>b.id===s.id?t:b))}catch{o({title:"خطأ",description:"فشل في تحديث حالة التوفر",variant:"destructive"})}},[a,n,o]),P=i.useCallback(()=>{r(null),h(!1)},[]),A=i.useCallback((s,t)=>{r(l=>l?{...l,[s]:t}:null)},[]),M=i.useMemo(()=>g||w||n===null?e.jsxs("div",{className:"container mx-auto px-6 py-20 text-center",children:[e.jsx(q,{className:"mx-auto mb-4 text-amber-700 animate-spin",size:48}),e.jsx("p",{className:"text-xl text-amber-700",children:"جاري التحميل..."})]}):a?n?e.jsxs("div",{className:"container mx-auto px-6 py-8",children:[e.jsxs("div",{className:"flex justify-between items-center mb-8",children:[e.jsx("h1",{className:"text-3xl font-bold text-amber-900",children:"إدارة المنتجات"}),e.jsxs("button",{onClick:()=>{h(!0),r(J)},className:"bg-green-600 text-white px-4 py-2 rounded-lg hover:bg-green-700 transition-colors flex items-center gap-2","aria-label":"إضافة منتج جديد",children:[e.jsx(V,{size:20})," إضافة منتج جديد"]})]}),(d||N)&&e.jsx(K,{product:d,isSaving:k,onFieldChange:A,onSave:()=>d&&S(d),onCancel:P}),c.length===0?e.jsxs("div",{className:"text-center py-16",children:[e.jsx(y,{className:"mx-auto mb-4 text-gray-400",size:64}),e.jsx("p",{className:"text-xl text-gray-600 mb-4",children:"لا توجد منتجات بعد"})]}):e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6",children:c.map(s=>e.jsx(O,{product:s,onEdit:()=>{r(s),h(!1)},onDelete:()=>j(s.id),onToggleAvailability:()=>z(s)},s.id))})]}):e.jsxs("div",{className:"container mx-auto px-6 py-20 text-center",children:[e.jsx(y,{className:"mx-auto mb-4 text-red-600",size:64}),e.jsx("h2",{className:"text-2xl font-bold text-red-700 mb-4",children:"لا تملك صلاحية الوصول إلى هذه الصفحة"})]}):e.jsxs("div",{className:"container mx-auto px-6 py-20 text-center",children:[e.jsx(y,{className:"mx-auto mb-4 text-amber-700",size:64}),e.jsx("h2",{className:"text-2xl font-bold text-amber-900 mb-4",children:"يجب تسجيل الدخول أولاً"}),e.jsx("a",{href:"/auth",className:"bg-amber-600 text-white px-6 py-3 rounded-lg hover:bg-amber-700 transition-colors",children:"تسجيل الدخول"})]}),[g,w,n,a,c,d,N,k,A,S,P,z]);return e.jsxs("div",{dir:"rtl",className:"min-h-screen bg-gradient-to-b from-amber-50 to-orange-50",children:[e.jsxs(L,{children:[e.jsx("title",{children:"لوحة تحكم الأدمن"}),e.jsx("meta",{name:"robots",content:"noindex, nofollow"}),e.jsx("meta",{name:"googlebot",content:"noindex, nofollow"}),e.jsx("meta",{"http-equiv":"Cache-Control",content:"no-store, max-age=0"}),e.jsx("meta",{name:"description",content:"صفحة إدارة خاصة بالموقع"})]}),e.jsx(R,{}),M,e.jsx(X,{open:v!==null,onCancel:()=>j(null),onConfirm:()=>v&&I(v),title:"تأكيد الحذف",message:"هل أنت متأكد من رغبتك في حذف هذا المنتج؟",confirmText:"نعم، احذف",cancelText:"إلغاء"})]})},K=T.memo(({product:a,isSaving:g,onFieldChange:c,onSave:m,onCancel:d})=>e.jsxs("div",{className:"bg-white rounded-lg shadow-md p-6 mb-8",children:[e.jsx("h2",{className:"text-xl font-bold text-amber-900 mb-4",children:a!=null&&a.id?"تعديل المنتج":"إضافة منتج جديد"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx("label",{className:"block font-medium text-amber-800",children:"اسم المنتج بالعربية *"}),e.jsx("input",{type:"text",value:(a==null?void 0:a.name_ar)||"",onChange:r=>c("name_ar",r.target.value),placeholder:"مثل: قهوة عربية",className:"w-full px-4 py-2 border border-amber-300 rounded-lg focus:ring-2 focus:ring-amber-500 focus:outline-none",required:!0})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("label",{className:"block font-medium text-amber-800",children:"السعر (جنيه) *"}),e.jsx("input",{type:"number",value:(a==null?void 0:a.price)||"",onChange:r=>c("price",Number(r.target.value)),placeholder:"مثل: 50",min:"0",step:"0.5",className:"w-full px-4 py-2 border border-amber-300 rounded-lg focus:ring-2 focus:ring-amber-500 focus:outline-none",required:!0})]}),e.jsxs("div",{className:"md:col-span-2 space-y-1",children:[e.jsx("label",{className:"block font-medium text-amber-800",children:"الوصف بالعربية *"}),e.jsx("textarea",{value:(a==null?void 0:a.description_ar)||"",onChange:r=>c("description_ar",r.target.value),placeholder:"وصف المنتج ومميزاته",className:"w-full px-4 py-2 border border-amber-300 rounded-lg focus:ring-2 focus:ring-amber-500 focus:outline-none min-h-[100px]",required:!0})]}),e.jsxs("div",{className:"md:col-span-2 space-y-1",children:[e.jsx("label",{className:"block font-medium text-amber-800",children:"رابط الصورة *"}),e.jsx("input",{type:"url",value:(a==null?void 0:a.image_url)||"",onChange:r=>c("image_url",r.target.value),placeholder:"https://example.com/image.jpg",className:"w-full px-4 py-2 border border-amber-300 rounded-lg focus:ring-2 focus:ring-amber-500 focus:outline-none",required:!0})]}),e.jsxs("div",{className:"md:col-span-2 space-y-1",children:[e.jsx("label",{className:"block font-medium text-amber-800",children:"رابط نموذج جوجل"}),e.jsx("input",{type:"url",value:(a==null?void 0:a.googleFormUrl)||"",onChange:r=>c("googleFormUrl",r.target.value),placeholder:"https://docs.google.com/forms/...",className:"w-full px-4 py-2 border border-amber-300 rounded-lg focus:ring-2 focus:ring-amber-500 focus:outline-none"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("label",{className:"font-semibold text-amber-900",children:"التوفر"}),e.jsx("input",{type:"checkbox",checked:(a==null?void 0:a.available)||!1,onChange:r=>c("available",r.target.checked),className:"w-5 h-5 accent-amber-600"})]})]}),e.jsxs("div",{className:"mt-6 flex gap-4",children:[e.jsxs("button",{onClick:m,disabled:g,className:"bg-amber-600 text-white px-4 py-2 rounded-lg hover:bg-amber-700 transition-colors flex items-center gap-2 disabled:opacity-70","aria-label":"حفظ المنتج",children:[g?e.jsx(q,{className:"animate-spin",size:18}):e.jsx(B,{size:18}),"حفظ"]}),e.jsxs("button",{onClick:d,className:"bg-gray-300 text-gray-800 px-4 py-2 rounded-lg hover:bg-gray-400 transition-colors flex items-center gap-2","aria-label":"إلغاء التعديل",children:[e.jsx(F,{size:18})," إلغاء"]})]})]})),O=T.memo(({product:a,onEdit:g,onDelete:c,onToggleAvailability:m})=>e.jsxs("div",{className:"bg-white rounded-lg shadow-md p-4 flex flex-col gap-3 hover:shadow-lg transition-shadow",children:[e.jsx("img",{src:a.image_url,alt:a.name_ar,className:"rounded-lg object-cover aspect-[6/6] w-full bg-gray-100",loading:"lazy",onError:d=>d.currentTarget.src="/placeholder-image.png"}),e.jsx("h3",{className:"text-lg font-bold text-amber-900",children:a.name_ar}),e.jsx("p",{className:"text-amber-700 line-clamp-2",children:a.description_ar}),e.jsxs("p",{className:"font-semibold text-amber-900",children:["السعر: ",a.price.toFixed(2)," جنيه"]}),e.jsxs("p",{children:["التوفر:"," ",e.jsx("span",{className:a.available?"text-green-600":"text-red-600",children:a.available?"متوفر":"غير متوفر"})]}),e.jsxs("div",{className:"flex flex-wrap gap-2 mt-auto pt-2",children:[e.jsxs("button",{onClick:g,className:"bg-yellow-400 text-yellow-900 px-3 py-1 rounded-lg hover:bg-yellow-500 transition-colors flex items-center gap-1","aria-label":"تعديل المنتج",children:[e.jsx(G,{size:16})," تعديل"]}),e.jsxs("button",{onClick:c,className:"bg-red-600 text-white px-3 py-1 rounded-lg hover:bg-red-700 transition-colors flex items-center gap-1","aria-label":"حذف المنتج",children:[e.jsx($,{size:16})," حذف"]}),e.jsx("button",{onClick:m,className:`px-3 py-1 rounded-lg transition-colors flex items-center gap-1 ${a.available?"bg-gray-600 text-white hover:bg-gray-700":"bg-green-600 text-white hover:bg-green-700"}`,"aria-label":a.available?"تعطيل المنتج":"تفعيل المنتج",children:a.available?"تعطيل":"تفعيل"})]})]}));export{ae as default};
