import{c as q,d as L,b as A,a as $,r as t,j as e,X as P,s as S}from"./index-CuLUR7ue.js";import{C as O,d as D}from"./card-Dpo-wQso.js";import{S as I}from"./Navbar-DUxwz1eI.js";import{C as F}from"./user-CLQm5Qt5.js";/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Q=q("ExternalLink",[["path",{d:"M15 3h6v6",key:"1q9fwt"}],["path",{d:"M10 14 21 3",key:"gplh6r"}],["path",{d:"M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6",key:"a6xqqp"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const U=q("Filter",[["polygon",{points:"22 3 2 3 10 12.46 10 19 14 21 14 12.46 22 3",key:"1yg77f"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const W=q("RotateCcw",[["path",{d:"M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8",key:"1357e3"}],["path",{d:"M3 3v5h5",key:"1xhq8a"}]]),G=({product:r})=>{const{user:a}=L(),{toast:i}=A();$();const[j,d]=t.useState(!1),[m,s]=t.useState(1),[u,x]=t.useState(""),[b,y]=t.useState(!1),o=r.price*m,w=async()=>{if(!a){i({title:"يجب تسجيل الدخول",description:"يرجى تسجيل الدخول لإضافة المنتجات إلى السلة.",variant:"destructive"});return}y(!0);try{const{data:n,error:c}=await S.from("cart_items").select("*").eq("user_id",a.id).eq("product_id",r.id).single();if(c&&c.code!=="PGRST116")throw c;if(n){const p=n.quantity+m,N=p*r.price,{error:_}=await S.from("cart_items").update({quantity:p,total_price:N}).eq("user_id",a.id).eq("product_id",r.id);if(_)throw _}else{const{error:p}=await S.from("cart_items").insert({user_id:a.id,product_id:r.id,quantity:m,unit_price:r.price,total_price:r.price*m});if(p)throw p}i({title:"تمت الإضافة إلى السلة",description:`${r.name_ar} أُضيف إلى السلة.`})}catch(n){console.error("خطأ في إضافة المنتج إلى السلة:",n),i({title:"خطأ",description:"فشل في إضافة المنتج إلى السلة.",variant:"destructive"})}finally{y(!1)}},v=()=>{if(!a){i({title:"يجب تسجيل الدخول",description:"يرجى تسجيل الدخول لإتمام الطلب.",variant:"destructive"});return}x(""),s(1),d(!0)},C=()=>{d(!1)},k=async n=>{if(n.preventDefault(),!u.trim()){i({title:"عنوان الشحن مطلوب",description:"يرجى إدخال عنوان الشحن لإتمام الطلب.",variant:"destructive"});return}try{const{data:c,error:p}=await S.from("orders").insert({user_id:a.id,status:"pending",payment_status:"pending",total_amount:o,notes:"",shipping_address:u}).select().single();if(p||!c)throw p;const N=c.id,{error:_}=await S.from("order_items").insert({order_id:N,product_id:r.id,quantity:m,unit_price:r.price,total_price:o});if(_)throw _;i({title:"تم الطلب",description:`${r.name_ar} تم إضافته إلى طلباتك.`}),d(!1)}catch(c){console.error("خطأ في تنفيذ الطلب:",c),i({title:"خطأ",description:"فشل في تنفيذ الطلب.",variant:"destructive"})}},l=()=>s(n=>n+1),f=()=>s(n=>n>1?n-1:1);return e.jsxs(e.Fragment,{children:[e.jsxs(O,{className:"w-full max-w-sm overflow-hidden rounded-md border bg-white shadow-lg transition-shadow duration-300 hover:shadow-2xl flex flex-col",children:[e.jsx("div",{className:"relative w-full aspect-[6/6] overflow-hidden p-2",children:e.jsx("img",{src:r.image_url||"",alt:r.name_ar,className:"w-full h-full object-cover rounded-md transition-transform duration-300 hover:scale-105",loading:"lazy",decoding:"async"})}),e.jsxs(D,{className:"p-4 flex flex-col flex-grow",children:[e.jsx("h2",{className:"mb-2 text-xl font-bold text-gray-800 truncate",title:r.name_ar,children:r.name_ar}),e.jsx("p",{className:"mb-4 text-gray-600 line-clamp-5",title:r.description_ar,children:r.description_ar}),e.jsxs("div",{className:"text-lg font-semibold text-amber-600 mb-4",children:[r.price," جنيه"]}),e.jsxs("div",{className:"flex justify-between gap-3 mt-auto",children:[e.jsx("button",{onClick:w,disabled:b,className:"bg-amber-500 hover:bg-amber-600 text-white px-4 py-2 rounded-md font-bold shadow-lg transform hover:scale-105 transition-all duration-300 flex items-center gap-2 disabled:opacity-75","aria-label":`أضف ${r.name_ar} إلى السلة`,children:b?e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"animate-spin",children:"↻"}),"جاري الإضافة"]}):e.jsxs(e.Fragment,{children:[e.jsx(I,{size:16}),"أضف إلى السلة"]})}),e.jsxs("button",{onClick:v,className:"bg-gradient-to-r from-amber-600 to-orange-600 hover:from-amber-700 hover:to-orange-700 text-white px-4 py-2 rounded-md font-bold shadow-lg transform hover:scale-105 transition-all duration-300 flex items-center gap-2","aria-label":`اطلب ${r.name_ar} الآن`,children:[e.jsx(Q,{size:16}),"اطلب الآن"]})]})]})]}),j&&e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-50",children:e.jsxs("div",{className:"bg-white rounded-xl w-full max-w-md p-6 relative shadow-lg",children:[e.jsx("img",{src:r.image_url||"",alt:r.name_ar,className:"w-20 h-20 rounded object-cover absolute top-6 left-6"}),e.jsx("button",{onClick:C,className:"absolute top-4 right-4 text-gray-600 hover:text-gray-900","aria-label":"إغلاق",children:e.jsx(P,{size:24})}),e.jsx("h3",{className:"mb-4 text-xl font-bold text-center text-gray-800 pt-6",children:"تأكيد الطلب"}),e.jsxs("div",{className:"mt-20 mb-4 text-center",children:[e.jsx("h4",{className:"font-semibold text-lg",children:r.name_ar}),e.jsx("p",{className:"text-gray-600",children:r.description_ar})]}),e.jsxs("form",{onSubmit:k,children:[e.jsx("label",{className:"block mb-2 font-semibold",htmlFor:"shippingAddress",children:"عنوان الشحن"}),e.jsx("input",{id:"shippingAddress",type:"text",value:u,onChange:n=>x(n.target.value),placeholder:"أدخل عنوان الشحن",className:"w-full p-2 border rounded mb-4",required:!0}),e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{type:"button",onClick:f,className:"bg-gray-300 hover:bg-gray-400 px-3 py-1 rounded","aria-label":"إنقاص الكمية",children:"-"}),e.jsx("span",{className:"px-3","aria-live":"polite","aria-atomic":"true",children:m}),e.jsx("button",{type:"button",onClick:l,className:"bg-gray-300 hover:bg-gray-400 px-3 py-1 rounded","aria-label":"زيادة الكمية",children:"+"})]}),e.jsxs("div",{className:"font-bold text-lg","aria-live":"polite","aria-atomic":"true",children:["الإجمالي: ",o," جنيه"]})]}),e.jsx("button",{type:"submit",className:"w-full bg-amber-600 hover:bg-orange-600 text-white py-3 rounded font-bold transition-colors","aria-label":"تأكيد الطلب",children:"تأكيد الطلب"})]})]})})]})};function H(r,a,i){var j=this,d=t.useRef(null),m=t.useRef(0),s=t.useRef(null),u=t.useRef([]),x=t.useRef(),b=t.useRef(),y=t.useRef(r),o=t.useRef(!0);y.current=r;var w=typeof window<"u",v=!a&&a!==0&&w;if(typeof r!="function")throw new TypeError("Expected a function");a=+a||0;var C=!!(i=i||{}).leading,k=!("trailing"in i)||!!i.trailing,l="maxWait"in i,f="debounceOnServer"in i&&!!i.debounceOnServer,n=l?Math.max(+i.maxWait||0,a):null;t.useEffect(function(){return o.current=!0,function(){o.current=!1}},[]);var c=t.useMemo(function(){var p=function(h){var g=u.current,z=x.current;return u.current=x.current=null,m.current=h,b.current=y.current.apply(z,g)},N=function(h,g){v&&cancelAnimationFrame(s.current),s.current=v?requestAnimationFrame(h):setTimeout(h,g)},_=function(h){if(!o.current)return!1;var g=h-d.current;return!d.current||g>=a||g<0||l&&h-m.current>=n},M=function(h){return s.current=null,k&&u.current?p(h):(u.current=x.current=null,b.current)},E=function h(){var g=Date.now();if(_(g))return M(g);if(o.current){var z=a-(g-d.current),T=l?Math.min(z,n-(g-m.current)):z;N(h,T)}},R=function(){if(w||f){var h=Date.now(),g=_(h);if(u.current=[].slice.call(arguments),x.current=j,d.current=h,g){if(!s.current&&o.current)return m.current=d.current,N(E,a),C?p(d.current):b.current;if(l)return N(E,a),p(d.current)}return s.current||N(E,a),b.current}};return R.cancel=function(){s.current&&(v?cancelAnimationFrame(s.current):clearTimeout(s.current)),m.current=0,u.current=d.current=x.current=s.current=null},R.isPending=function(){return!!s.current},R.flush=function(){return s.current?M(Date.now()):b.current},R},[C,l,a,n,k,v,w,f]);return c}function V(r,a){return r===a}function X(r,a,i){var j=V,d=t.useRef(r),m=t.useState({})[1],s=H(t.useCallback(function(x){d.current=x,m({})},[m]),a,i),u=t.useRef(r);return j(u.current,r)||(s(r),u.current=r),[d.current,s]}const B=({searchTerm:r,setSearchTerm:a,priceFilter:i,setPriceFilter:j,ratingFilter:d,setRatingFilter:m,resetFilters:s,resultCount:u})=>{const[x,b]=t.useState(!1),y=()=>{s(),b(!1)};return e.jsxs("div",{className:"mb-6",children:[e.jsxs("div",{className:"flex items-center gap-3 bg-white rounded-xl p-3 shadow-sm",children:[e.jsxs("div",{className:"relative flex-grow",children:[e.jsx("input",{type:"text",placeholder:"ابحث عن منتجات...",value:r,onChange:o=>a(o.target.value),className:"w-full pr-10 pl-4 py-2 border border-amber-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-amber-400"}),r&&e.jsx("button",{onClick:()=>a(""),className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-amber-600 hover:text-amber-800","aria-label":"مسح البحث",children:e.jsx(P,{size:18})})]}),e.jsxs("button",{onClick:()=>b(!0),className:"flex items-center gap-1 px-3 py-2 bg-amber-100 text-amber-800 rounded-lg hover:bg-amber-200 transition-colors","aria-label":"فتح فلاتر البحث",children:[e.jsx(U,{size:18}),e.jsx("span",{className:"hidden sm:inline",children:"تصفية"})]})]}),x&&e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-xl shadow-xl w-full max-w-md max-h-[90vh] overflow-y-auto",children:[e.jsxs("div",{className:"sticky top-0 bg-white p-4 border-b flex justify-between items-center",children:[e.jsx("h3",{className:"text-lg font-bold text-amber-800",children:"تصفية النتائج"}),e.jsx("button",{onClick:()=>b(!1),className:"p-1 rounded-full hover:bg-amber-50 text-amber-600","aria-label":"إغلاق النافذة",children:e.jsx(P,{size:24})})]}),e.jsxs("div",{className:"p-4 space-y-6",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium text-gray-700 mb-2",children:"السعر"}),e.jsx("div",{className:"grid grid-cols-2 gap-3",children:[{value:"all",label:"الكل"},{value:"low",label:"أقل من 80 ج"},{value:"medium",label:"80-100 ج"},{value:"high",label:"أكثر من 100 ج"}].map(o=>e.jsx("button",{onClick:()=>j(o.value),className:`py-2 px-3 rounded-lg border transition-colors ${i===o.value?"border-amber-500 bg-amber-50 text-amber-800":"border-gray-200 hover:border-amber-300"}`,children:o.label},o.value))})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium text-gray-700 mb-2",children:"التقييم"}),e.jsx("div",{className:"grid grid-cols-2 gap-3",children:[{value:"all",label:"الكل"},{value:"4.5",label:"4.5+ نجوم"},{value:"4.0",label:"4+ نجوم"},{value:"3.0",label:"3+ نجوم"}].map(o=>e.jsx("button",{onClick:()=>m(o.value),className:`py-2 px-3 rounded-lg border transition-colors ${d===o.value?"border-amber-500 bg-amber-50 text-amber-800":"border-gray-200 hover:border-amber-300"}`,children:o.label},o.value))})]})]}),e.jsxs("div",{className:"sticky bottom-0 bg-white p-4 border-t flex justify-between items-center",children:[e.jsxs("div",{className:"text-sm text-gray-600",children:[u," نتيجة"]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsxs("button",{onClick:y,className:"flex items-center gap-1 px-4 py-2 text-amber-700 hover:bg-amber-50 rounded-lg transition-colors",children:[e.jsx(W,{size:16}),"إعادة تعيين"]}),e.jsx("button",{onClick:()=>b(!1),className:"px-6 py-2 bg-amber-600 text-white rounded-lg hover:bg-amber-700 transition-colors",children:"تطبيق الفلاتر"})]})]})]})})]})},ee=()=>{const[r,a]=t.useState([]),[i,j]=t.useState([]),[d,m]=t.useState(""),[s,u]=t.useState("all"),[x,b]=t.useState("all"),[y,o]=t.useState(!0),{toast:w}=A(),[v]=X(d,300),C=t.useCallback(async()=>{try{const{data:l,error:f}=await S.from("products").select("*").eq("available",!0).order("created_at",{ascending:!1});if(f)throw f;const n=(l==null?void 0:l.map(c=>({id:c.id,name_ar:c.name_ar||c.name||"",description_ar:c.description_ar||c.description||"",price:Number(c.price)||0,image_url:c.image_url||"/api/placeholder/300/200",rating:c.rating||0,googleFormUrl:c.googleFormUrl||"",available:c.available??!0})))||[];a(n),j(n)}catch(l){console.error("Error fetching products:",l),w({title:"خطأ",description:"فشل في تحميل المنتجات",variant:"destructive"})}finally{o(!1)}},[w]);t.useEffect(()=>{C()},[C]);const k=t.useCallback(()=>{let l=r;if(v&&(l=l.filter(f=>f.name_ar.toLowerCase().includes(v.toLowerCase())||f.description_ar.toLowerCase().includes(v.toLowerCase()))),s!=="all"&&(l=l.filter(f=>{const n=Number(f.price)||0;return s==="low"?n<80:s==="medium"?n>=80&&n<=100:s==="high"?n>100:!0})),x!=="all"){const f=parseFloat(x);l=l.filter(n=>n.rating>=f)}return l},[v,s,x,r]);return t.useEffect(()=>{j(k())},[k]),y?e.jsx("section",{id:"products",className:"py-20 bg-gradient-to-b from-amber-50 to-orange-50",children:e.jsx("div",{className:"container mx-auto px-6",children:e.jsxs("div",{className:"text-center",children:[e.jsx(F,{className:"mx-auto mb-4 text-amber-700 animate-spin",size:48}),e.jsx("p",{className:"text-xl font-semibold text-amber-700",children:"جاري تحميل المنتجات، يرجى الانتظار..."})]})})}):e.jsx("section",{id:"products",className:"py-20 bg-gradient-to-b from-amber-50 to-orange-50",children:e.jsxs("div",{className:"container mx-auto px-6",children:[e.jsxs("div",{className:"text-center mb-16",children:[e.jsxs("div",{className:"flex justify-center items-center mb-6",children:[e.jsx("div",{className:"h-1 w-16 bg-gradient-to-r from-transparent to-amber-600"}),e.jsx(F,{className:"mx-4 text-amber-700",size:28}),e.jsx("div",{className:"h-1 w-16 bg-gradient-to-l from-transparent to-amber-600"})]}),e.jsx("h2",{className:"text-4xl md:text-5xl font-bold text-amber-900 mb-4",children:"منتجاتنا المميزة"}),e.jsx("p",{className:"text-xl text-amber-700 max-w-2xl mx-auto",children:"اختر من مجموعة واسعة من أجود أنواع القهوة المحمصة بعناية"})]}),r.length>0&&e.jsx(B,{searchTerm:d,setSearchTerm:m,priceFilter:s,setPriceFilter:u,ratingFilter:x,setRatingFilter:b,resetFilters:()=>{m(""),u("all"),b("all")},resultCount:i.length}),i.length===0?e.jsxs("div",{className:"text-center py-16",children:[e.jsx(F,{className:"mx-auto mb-4 text-gray-400",size:64}),e.jsx("p",{className:"text-xl text-gray-600",children:r.length===0?"لا توجد منتجات متاحة حالياً":"لا توجد نتائج تطابق البحث أو الفلاتر المحددة"})]}):e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-8",children:i.map(l=>e.jsx(G,{product:l},l.id))}),e.jsx("div",{className:"text-center mt-16",children:e.jsxs("div",{className:"bg-gradient-to-r from-amber-100 to-orange-100 rounded-2xl p-8 max-w-4xl mx-auto border-2 border-amber-200",children:[e.jsx(F,{className:"mx-auto mb-4 text-amber-700",size:48}),e.jsx("h3",{className:"text-2xl font-bold text-amber-900 mb-4",children:"✨ عرض خاص للعملاء الجدد ✨"}),e.jsx("p",{className:"text-lg text-amber-800 mb-6",children:"توصيل مجاني داخل دمنهور للطلبات أكثر من 150 جنيه"}),e.jsxs("button",{onClick:()=>window.open("https://wa.me/+201229204276?text=أريد الاستفادة من العرض الخاص","_blank"),className:"bg-gradient-to-r from-green-600 to-green-700 hover:from-green-700 hover:to-green-800 text-white px-6 py-3 rounded-full font-semibold shadow-lg transition flex items-center justify-center gap-2",children:[e.jsx(F,{size:20})," اطلب الآن عبر واتساب"]})]})})]})})};export{ee as default};
